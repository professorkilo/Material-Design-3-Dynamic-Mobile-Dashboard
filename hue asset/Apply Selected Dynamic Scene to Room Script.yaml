alias: Apply Selected Dynamic Scene to Room
mode: parallel
fields:
  room_lights:
    description: Lights to apply the scene to
    example: light.light_one_sofa, light.light_two_sofa
  presence_automation:
    description: Room presence automation to disable
    example: automation.room_presence_sofa
  room_boolean:
    description: The input_boolean used for UI state/glow
    example: input_boolean.sofa_dynamic_scene
  room_scene_tracker:
    description: Input text to track what scene is running in the room
    example: input_text.sofa_dynamic_scene_active
sequence:
  - alias: Disable presence automation for the room
    action: homeassistant.turn_off
    data:
      entity_id: "{{ presence_automation }}"
  - delay:
      milliseconds: 500
  - alias: Set active scene tracker for the room
    action: input_text.set_value
    data:
      entity_id: "{{ room_scene_tracker }}"
      value: "{{ states('input_text.dynamic_scene_selected') }}"
  - alias: Turn on visual boolean (for chip styling)
    action: homeassistant.turn_on
    data:
      entity_id: "{{ room_boolean }}"
  - alias: Load currently selected scene from input_text
    variables:
      selected_scene: "{{ states('input_text.dynamic_scene_selected') | lower }}"
  - alias: Start the dynamic scene
    action: scene_presets.start_dynamic_scene
    data:
      preset_id: |
        {% set scene_map = {
          'still_waters': '0629d5c4-ecbb-4ffd-afc3-6e6239e5e25d',
          'hazy_days': '2d7f9e7a-5c94-4768-bd5a-6924d670dde0',
          'color_burst': 'e24e9183-747e-4d4e-a950-a746c6291c90',
          'zandvoort': 'f85558ad-f8db-461a-8ff3-7458e9f7320f',
          'rosy_sparkle': 'cf50bd49-16b1-47fd-a020-b83072595f37',
          'blue_lagoon': '58d2dda6-8689-46c7-931b-d3abd039f04b',
          'adrift': '67f8677a-ba4e-45d4-9a7e-601a7bdbd04d',
          'majestic_morning': 'a07439ee-8a0b-4d86-9378-687acf1c1954',
          'dreamy_dusk': 'a127f9ef-0371-48dc-bc79-852e2e5b2cc3',
          'miami': 'a592fa63-4ba6-4399-a120-1c0b79ac832d',
          'palm_beach': 'e780c175-09a9-4080-978a-1d5909d8588f',
          'bahrain': 'ad69cf77-3068-489b-96e8-1aa6e20759a7',
          'silent_night': '4760abd5-e5a6-425a-be32-8f37f6e2acfd',
          'silverstone': 'c2ba8a69-acdf-4ce1-8bb2-f1b3819f1c0f',
          'amethyst_valley': '297700b8-fcc6-4f35-88bb-900935d9da49',
          'cancun': 'c321d848-51a8-4d09-9ad0-5e6b44bc7f2c',
          'under_the_tree': '85b8bc42-c564-4661-b058-f4e5792a6a6c',
          'festive_fun': '667e4f15-4abf-4c56-8ef4-74fe1df422b8',
          'ruby_glow': '454176dd-7d24-43de-86c4-ee73f8febbec',
          'pensive': 'ad1b1e0d-191d-4144-aaa5-b85b2fc5dc10',
          'savannah_sunset': 'ea580cb0-149e-48e6-a729-2a500edfb924',
          'tropical_twilight': 'ffbf7ff8-dc4a-4c56-b157-7a59113be7b7',
          'sao_paulo': 'a84a9a0c-282d-4b55-8b9c-be9d85455623',
          'midwinter': 'fd55a078-d6a3-4715-9176-5a4fcbf5b3e6',
          'snow_sparkle': '6a794ffd-3564-493d-a9ad-a1abcec8b81c',
          'tokyo': 'de7eda64-84bf-4ed6-a4fa-76e0ebdd1968',
          'fairfax': 'abfc5768-5c2c-4d61-bd03-2b64660e813f',
          'rolling_hills': '49c61bae-d3ec-4df2-89a4-65235705f3a1',
          'spring_lake': 'f2661458-aad1-4467-97cf-8ccd46abec4e',
          'golden_pond': '89c16361-391d-4346-b6d8-ac1eaf4de3dc',
          'chinatown': '7581da02-1688-4128-9bb9-b635f3b89999',
          'ibiza': 'eaa0d424-ac66-4247-8342-06d2b128ac31',
          'osaka': '5768805d-27c1-442e-b069-d20443485201',
          'motown': '7dded6f8-a2aa-4726-b391-21e9a0f76eee',
          'galaxy': 'a6ba3a6e-1e3a-41fd-84f2-f7b021935deb',
          'arctic_aurora': '940fd864-51e1-4761-95d3-75d4d68835ea',
          'moonlight': 'a87a8467-82ff-43f8-aaf3-6649b57b1480',
          'nebula': '3c8662e5-e650-4f6a-a4b2-03b66d502f77',
          'starlight': 'a2f95aab-e80a-4aca-ae32-142cdc7ad3e0',
          'blood_moon': '8d0f34db-78fd-475d-9bed-a502b787964d',
          'blossom': 'd648408d-58ab-4768-b192-47ce06dc8e61',
          'crocus': 'cf25db7e-72b6-499f-8a5d-552e723a6c6a',
          'precious': '506abd58-b926-4786-bb35-3a52a0c0b4d4',
          'narcissa': '6b8cbab7-6090-484f-b0c2-43176e1bb044',
          'mountain_breeze': '24964f19-ad24-402d-ab79-aaec30cfa1d8',
          'lake_mist': '7c6e81e7-d89a-4759-ae9e-b7c41e3fc0cb',
          'sunday_morning': '2cbd7faf-f06f-4fe7-98af-80c7e7f3e437',
          'spring_blossom': '2be1f2f4-4e47-4fcc-a99c-4195da6210ea',
          'scarlet_dream': '51960d8b-e47a-4b04-9163-28e3bbc91601',
          'resplendent': 'ce4a5344-e052-43da-904a-123d7c024bf3',
          'memento': 'c3058e2f-695d-445c-b859-b6567c856e4e',
          'emerald_flutter': '95048fa7-6283-4253-9ca8-ad090b33f3e7',
          'misty_ridge': '680a54fc-3477-4909-8d99-f35a9dc87e50',
          'autumn_gold': '1f0ef091-949a-4efe-a7ed-c396cea3423a',
          'ruby_romance': '68d97db1-eb52-4c03-8afc-eed5df30c417',
          'city_of_love': '1fde4a1b-2ace-4b3a-a517-f9660fc84536',
          'sunset_allure': '68e8b68e-8237-48a6-bf5f-f62258dd2ff3',
          'lovebirds': 'f1f5f209-ffcb-4734-8567-0819a2885214',
          'smitten': 'a65a2815-52fb-4748-8e02-b607f96f70ea',
          'promise': '68d97db1-eb52-4c03-8afc-eed5df30c417'
        } %}
        {{ scene_map.get(selected_scene, 'default-preset-id') }}
      brightness: >-
        {{ (states('input_number.dynamic_scene_brightness') | float * 2.55) |
        round(0) | int }}
      interval: "{{ states('input_number.dynamic_scene_interval') | int }}"
      targets:
        entity_id: "{{ room_lights }}"
      transition: 5
description: ""
